<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Psychology</title>
    <link rel="stylesheet" href="style.css">
    <script type="importmap">
    {
        "imports": {
            "three": "./lib/three/three.module.js",
            "three/addons/": "./lib/three/addons/"
        }
    }
    </script>
</head>
<body>
    <div class="game-container">
        <div id="info-banner">
            <p class="log-info">Welcome to Universal Psychology! Click 'Add Neurons' or answer questions to begin developing your consciousness.</p>
        </div>

       <!-- New Main Page Header -->
        <header id="page-header">
            <!-- REMOVED: <h1>Universal Psychology</h1> -->
            <div class="header-stats-container">
                <div class="neuron-control">
                    <button id="click-button" data-lang-key="addNeurons"></button>
                    <div id="neurons-display">Neurons: 0</div>
                </div>
                <div id="psychbucks-display">Psychbucks: 0 | Passive: 0.0/s</div>
                <div id="iq-display">IQ: 80</div>
                <div id="ops-display">Ops: 0</div>
                <div id="neurofuel-display">Fuel: 0</div>
            </div>
            <div id="save-load-controls" class="save-load-controls">
                <label for="save-slot-select">Slot:</label>
                <select id="save-slot-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
                <button id="manual-save">Save</button>
                <button id="manual-load">Load</button>
                <button id="new-game">New Game</button>
            </div>
        </header>

        <!-- Main Content Area with Two Columns -->
        <div class="content-wrapper" style="display:none;">
            <aside class="left-column" style="display:none;">
                <section id="question-area">
                    <h2 data-lang-key="testYourKnowledge"></h2>
                    <div id="question-text">Upgrade your brain to unlock psychology questions!</div>
                    <div id="answer-options"></div>
                    <div id="feedback-area"></div>
                      <div id="streak-feedback-area"></div>
                </section>

                <section id="minigames-area">
                    <h2 data-lang-key="neuroGames"></h2>
                    <button id="open-neurosnake" style="display:none;">Play NeuroSnake</button>
                    <button id="open-braintetris">Play Brain Tetris</button>
                    <button id="open-flappyfreud" style="display:none;">Play Flappy Freud</button>
                    <button id="open-feedsundgren" style="display:none;">Feed Sundgren</button>
                </section>

            </aside>

            <main class="right-column">
                <section id="brain-visual-area" style="display:none;">
                    <div class="brain-viz-wrapper">
                        <h2 data-lang-key="yourBrain"></h2>
                        <div id="brain-viz-home-slot">
                            <div id="threejs-canvas-container"></div>
                        </div>
                    </div>
                </section>

                
                
                <!-- Container for scrollable content below brain viz -->
                <div class="right-column-lower-content">
                    <section id="upgrades-area" style="display:none;">
                        <h2 data-lang-key="coreUpgrades"></h2>
                        <div id="upgrades-list"></div>
                    </section>

                    <section id="factory-area" style="display: none;">
                        <h2 data-lang-key="proliferationFactories"></h2>
                        <p>Factories: <span id="factory-count">0</span></p>
                        <p>Cost: <span id="factory-cost">10</span> Psychbucks</p>
                        <button id="buy-factory-btn" data-lang-key="buyFactory"></button>
                    </section>

                    <section id="neuron-proliferation-area" style="display: none;">
                        <h2 data-lang-key="neuronProliferation"></h2>
                        <div id="neuron-proliferation-upgrades-list"></div>
                    </section>

                    <section id="neurofuel-area" style="display:none;">
                        <h2 data-lang-key="neurofuel"></h2>
                        <p>Fuel: <span id="neurofuel-count">10</span></p>
                        <p>Cost: <span id="neurofuel-cost">1</span> Psychbucks</p>
                        <button id="buy-neurofuel-btn" data-lang-key="buyFood"></button>
                    </section>

                    <section id="projects-area" style="display:none;">
                        <h2 data-lang-key="projects"></h2>
                        <div id="projects-list"></div>
                    </section>

                    <section id="hypothalamus-controls-area" style="display: none;">
                        <h2 data-lang-key="hypothalamusControls"></h2>
                        <div id="dopamine-control">
                            <label for="dopamine-slider" data-lang-key="dopamine"></label>
                            <input type="range" id="dopamine-slider" min="0" max="100" value="0">
                            <span id="dopamine-level-display">0</span>
                        </div>
                        <div id="gaba-control">
                            <label for="gaba-slider" data-lang-key="gaba"></label>
                            <input type="range" id="gaba-slider" min="0" max="100" value="0">
                            <span id="gaba-level-display">0</span>
                        </div>
                        <div id="anxiety-status">Anxiety Level: Normal</div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- NEW: Overlay for Scary Stimuli -->
        <div id="scary-stimuli-overlay"></div>
    <!-- Upgrade Animation Overlay -->
        <div id="upgrade-animation-overlay"></div>

    <!-- Brain Stats Popup -->
        <div id="brain-popup" class="popup-overlay">
            <div id="brain-popup-content">
                <button id="close-brain-popup">Close</button>
                <div id="brain-popup-visual-slot"></div>
                <div id="brain-popup-chart-section">
                    <canvas id="brain-stats-chart"></canvas>
                </div>
            </div>
        </div>

    <!-- Brain Tetris Popup -->
        <div id="braintetris-popup" class="popup-overlay">
            <div id="braintetris-content">
                <div class="braintetris-top">
                    <div class="braintetris-stats">
                        <div id="braintetris-score">Psychbucks Earned: 0</div>
                        <div id="braintetris-lines">Lines Cleared: 0</div>
                        <div id="braintetris-level">Level: 1</div>
                    </div>
                    <div class="braintetris-next">
                        <span>Next:</span>
                        <canvas id="braintetris-next" width="140" height="140"></canvas>
                    </div>
                </div>
                <div class="braintetris-head" id="braintetris-head">
                    <div class="braintetris-brain" id="braintetris-brain">
                        <canvas id="braintetris-canvas"></canvas>
                    </div>
                </div>
                <p id="braintetris-message">Use ← → to move, ↑ to rotate, ↓ to soft drop, and space to slam the squishy tetromino.</p>
                <div class="braintetris-controls">
                    <button id="start-braintetris">Start Brain Tetris</button>
                    <button id="close-braintetris">Close</button>
                </div>
            </div>
        </div>

    <!-- Flappy Freud Popup -->
        <div id="flappyfreud-popup" class="popup-overlay" aria-hidden="true">
            <div id="flappyfreud-content" role="dialog" aria-modal="true" aria-labelledby="flappyfreud-title">
                <div class="flappyfreud-header">
                    <div class="flappyfreud-title">
                        <h2 id="flappyfreud-title">Flappy Freud</h2>
                        <p id="flappyfreud-message">Press space or tap to start flying.</p>
                    </div>
                    <button id="close-flappyfreud" class="flappyfreud-close" aria-label="Close Flappy Freud">&times;</button>
                </div>
                <div class="flappyfreud-scoreboard">
                    <span id="flappyfreud-score">Score: 0</span>
                    <span id="flappyfreud-best">Best: 0</span>
                </div>
                <canvas id="flappyfreud-canvas" width="420" height="560"></canvas>
                <div id="flappyfreud-controls">Space/↑ to flap · Enter to restart · Esc to exit</div>
                <button id="start-flappyfreud" class="flappyfreud-start">Start Flight</button>
            </div>
        </div>

    <!-- NeuroSnake Popup -->
        <div id="neurosnake-popup" class="popup-overlay">
            <div id="neurosnake-content">
                <div id="neurosnake-score">Psychbucks: 0</div>
                <canvas id="neurosnake-canvas"></canvas>
                <p id="neurosnake-instruction">Press an arrow key to start</p>
                <button id="close-neurosnake">Close</button>
            </div>
        </div>

    <!-- Feed Sundgren Popup -->
        <div id="feedsundgren-popup" class="popup-overlay" aria-hidden="true">
            <div id="feedsundgren-content" role="dialog" aria-modal="true" aria-labelledby="feedsundgren-title">
                <div class="feedsundgren-header">
                    <div class="feedsundgren-title">
                        <h2 id="feedsundgren-title">Feed Sundgren</h2>
                        <p id="feedsundgren-message">Catch the falling snacks before they hit the ground.</p>
                    </div>
                    <button id="close-feedsundgren" class="feedsundgren-close" aria-label="Close Feed Sundgren">&times;</button>
                </div>
                <div class="feedsundgren-scoreboard">
                    <span id="feedsundgren-score">Snacks: 0</span>
                    <span id="feedsundgren-missed">Missed: 0/5</span>
                    <span id="feedsundgren-best">Best: 0</span>
                </div>
                <canvas id="feedsundgren-canvas" width="640" height="480" aria-label="Feed Sundgren playfield"></canvas>
                <div id="feedsundgren-controls">Use ←/→ or A/D to move. Tap or drag to position Sundgren.</div>
                <button id="start-feedsundgren" class="feedsundgren-start">Start Feeding</button>
            </div>
        </div>

    <!-- Instructions Overlay -->
        <div id="instructions-overlay">
            <div id="instructions-content">
                <h2>How to Play</h2>
                <p>Your goal is to produce as many neurons as possible and use them to build a bigger, better brain.</p>
                <p>Click <strong>Add Neurons</strong> to gain neurons or build proliferation factories for passive income.</p>
                <p>Spend neurons to buy upgrades that unlock new features and improve production.</p>
                <p><strong>Psychbucks</strong> accumulate from proliferation factories and projects. Use them for advanced upgrades.</p>
                <p>Manual neuron generation consumes <strong>Fuel</strong>. Purchase food to refill it.</p>
                <button id="close-instructions">Close</button>
            </div>
        </div>

        <button id="info-button">?</button>
    </div>

    <script src="./lib/chart.4.5.0.min.js"></script>
    <script type="module" src="three_scene.js"></script>
    <script type="module" src="game_logic.js"></script>
    <script type="module" src="neurosnake.js"></script>
    <script type="module" src="braintetris.js"></script>
    <script type="module" src="flappyfreud.js"></script>
    <script type="module" src="feedsundgren.js"></script>
</body>
</html>
